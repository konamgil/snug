rules:
  # === Security Rules ===

  - id: no-hardcoded-secrets
    patterns:
      - pattern-regex: '(?i)(password|secret|api[_-]?key|token|credentials)\s*[:=]\s*["\x27][^\"\x27]{8,}["\x27]'
    message: "Hardcoded secret detected. Use environment variables instead."
    languages: [typescript, javascript]
    severity: ERROR
    metadata:
      category: security
      cwe: "CWE-798: Use of Hard-coded Credentials"

  - id: no-eval
    pattern: eval(...)
    message: "Avoid using eval() as it can lead to code injection vulnerabilities."
    languages: [typescript, javascript]
    severity: ERROR
    metadata:
      category: security
      cwe: "CWE-95: Eval Injection"

  # === NestJS Best Practices ===

  - id: no-console-in-production
    pattern: console.log(...)
    message: "Avoid console.log in production code. Use the injected Logger service."
    languages: [typescript, javascript]
    severity: WARNING
    metadata:
      category: best-practices

  - id: catch-error-without-handling
    pattern: |
      catch ($ERR) {
      }
    message: "Empty catch block. Error should be logged or re-thrown."
    languages: [typescript]
    severity: ERROR
    metadata:
      category: error-handling

  # === Code Quality ===

  - id: no-explicit-any-parameter
    pattern: |
      function $FUNC(..., $PARAM: any, ...): $RET { ... }
    message: "Avoid using 'any' type for function parameters. Use specific types or 'unknown'."
    languages: [typescript]
    severity: WARNING
    metadata:
      category: code-quality

  - id: no-floating-promises
    pattern: |
      $ASYNC_FUNC(...);
    pattern-not: |
      await $ASYNC_FUNC(...);
    pattern-not: |
      return $ASYNC_FUNC(...);
    pattern-not: |
      $VAR = $ASYNC_FUNC(...);
    pattern-inside: |
      async function $FN(...) { ... }
    message: "Floating promise detected. Use await or handle the promise."
    languages: [typescript]
    severity: WARNING
    metadata:
      category: code-quality
